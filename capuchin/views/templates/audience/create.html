{% extends "base.html" %}
{% block title %}Create Segment{% endblock %}
{% set active_page='audience' %}
{% block head %}
<script src="/static/js/vendor/jquery.autocomplete.multiselect.js"></script>
<script>
    var id = "{{id}}";
    var filters = eval({{filters_json|safe}});
    var values = {{values|to_json}};

    $(document).ready(function(){
        $("#segment-refresh, #segment-save").click(function(e){
            $(".term-input").each(function(i, el){
                var vals = [];
                for(v in $(el).autocomplete("instance").selectedItems){
                    vals.push(v);
                }
                filters[$(el).data("field")] = vals;
            });
            var name=$("#title").html();
            var url = "{{ url_for('.filter_update', id=id, page=0) }}";
            var id = "records";
            $.ajax({
                url: url,
                type:"POST",
                data:{"filters":JSON.stringify(filters), "name":name},
                success: function(data){
                    $("#"+id).html(data);
                    register_table_sorting();
                    register_paging();
                    init_table_rows();
                    notify(
                        "success",
                        "Segment created! \
                        <a href='#'' class='btn btn-default' data-toggle='modal' data-target='#boost-modal'>Create</a> a Notification."
                    );
                }
            });
            return false;
        });
    });

</script>
{% endblock %}

{% block content %}
<div class="modal fade" id="boost-modal" tabindex="-1" role="dialog" aria-labelledby="New Notification" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modal-title">New Notification</h4>
            </div>
            <div class="modal-body" id="modal-body">
                {% set engage=True %}
                {% set segment_id=id %}
                {% include "notifications/form.html" %}
            </div>
        </div>
    </div>
</div>
<div class="row" id="filtered">
    {% include "audience/filtered.html" %}
</div>
{% endblock %}
