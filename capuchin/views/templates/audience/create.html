{% extends "base.html" %}
{% block title %}Create Segment{% endblock %}
{% set active_page='audience' %}
{% block head %}
<script src="/static/js/vendor/jquery.autocomplete.multiselect.js"></script>
<script>
    var id = "{{id}}";
    var filters = eval({{filters_json|safe}});
    var values = {{values|to_json}};

    function notify(text){
        $("#notification").html(text);
        $(".alert").removeClass("hidden");
    }

    $(document).ready(function(){
        $("#filter-submit").click(function(e){
            $(".term-input").each(function(i, el){
                console.log($(el).autocomplete("instance").selectedItems);
                var vals = [];
                for(v in $(el).autocomplete("instance").selectedItems){
                    vals.push(v);
                }
                filters[$(el).data("field")] = vals;
            });
            var name=$("#title").html();
            var url = "{{ url_for('.filter_update', id=id, page=0) }}";
            var id = "records";
            $.ajax({
                url: url,
                type:"POST",
                data:{"filters":JSON.stringify(filters), "name":name},
                success: function(data){
                    $("#"+id).html(data);
                    register_table_sorting();
                    register_paging();
                    init_table_rows();
                }
            });
            return false;
        });
    });

</script>
{% endblock %}

{% block content %}
<div class="row" id="filtered">
    {% include "audience/filtered.html" %}
</div>
{% endblock %}
