{% extends "base.html" %}
{% block title %}Create Segment{% endblock %}
{% block head %}
<script>
    var id = "{{id}}";
    var filters = eval({{filters_json|safe}});

    console.log(filters);

    function notify(text){
        $("#notification").html(text);
        $(".alert").removeClass("hidden");
    }

    $(document).ready(function(){
        $("#filter-submit").click(function(e){
            $(".term-input").each(function(i, el){
                filters[$(el).data("field")] = $(el).val();
            });
            $.pjax({
                container:"#records",
                url: "{{ url_for('.filter_update', id=id, page=0) }}",
                type:"POST",
                data:{"filters":JSON.stringify(filters)},
                push:false,
            });
        });

        $("#segment-name-save").click(function(e){
            $.pjax({
                container:"#notifications",
                url:"{{ url_for('.save', id=id) }}",
                type:"POST",
                data:{'name':$("#segment-name").val()},
                push:false,
            });
        });
    });
    $(document).pjax(".pager", "#records", {push:false, type:"POST"});

</script>
{% endblock %}

{% block content %}
<div class="row">
    <h3>New Segment</h3>
    <div class="input-group">
        <input type="text" class="form-control" placeholder="Segment Name" id="segment-name" value="{% if name %}{{name}}{% endif %}">
        <span class="input-group-btn">
            <button class="btn btn-default" id="segment-name-save" type="button">Save</button>
        </span>
    </div>
</div>
<div class="row" id="filtered">
    {% include "audience/filtered.html" %}
</div>
{% endblock %}
