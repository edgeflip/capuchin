{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block head %}
<script src="/static/vendor/topojson.v1.min.js"></script>
<script src="/static/js/charts/chart.js"></script>

<script>
$(document).ready(function(){
    /*
    $("#charts").usa({
        name:"Users by City",
        data_url:"{{url_for('.chart', chart_id='city_population')}}"
    }).render(12);
    $("#charts").vertical_circle({
        name:"Top Referrers",
        data_url:"{{url_for('.chart', chart_id='referrers')}}"
    }).render(12);
    $("#charts").horizontal_multibar({
        name:"Top Likes",
        data_url:"{{url_for('.chart', chart_id='top_likes')}}"
    }).render(12);
    */
    $("#charts").multibar({
        name:"Page Engagement",
        data_url:"{{url_for('.chart', chart_id='engaged_users')}}"
    }).render(12);
    /*
    $("#charts").word_bubble({
        name:"Top Words",
        data_url:"{{url_for('.chart', chart_id='top_words')}}"
    }).render(12);
    */
    $("#charts").stackedline({
        name:"Likes",
        data_url:"{{url_for('.chart', chart_id='likes')}}"
    }).render(12);
    $("#charts").lineplusbar({
        name:"Likes",
        data_url:"{{url_for('.chart', chart_id='like_gains')}}"
    }).render(12);
    $("#charts").pie({
        name:"Engagement by Story Type",
        data_url:"{{url_for('.chart', chart_id='page_by_type')}}"
    }).render(12);
    /*
    $("#charts").pie({
        name:"Engagement by Country",
        data_url:"{{url_for('.chart', chart_id='country')}}"
    }).render(12);*/
});
</script>
{% endblock %}

{% block content %}
    {% from "widgets/bucket.html" import bucket %}
    <div class="row">
        <div class="col-md-8" id="charts">
            <div class="row">
                <div class="col-md-12">
                    <h2>Recent Activity</h2>
                    <table class="table">
                        <thead>
                            <th>Published</th>
                            <th>Post</th>
                            <th>Type</th>
                            <th>Targeting</th>
                            <th>Reach</th>
                            <th>Engagement</th>
                            <th></th>
                        </thead>
                        <tbody>
                            {% for p in posts.hits %}
                            <tr>
                                <td>{{p.created_time}}</td>
                                <td>{{p.message|truncate(50)}}</td>
                                <td><span class="icon-picture"></span></td>
                                <td><span class="icon-globe"></span></td>
                                <td>1,101</td>
                                <td>
                                    <p>{{p.comments|length}}</p>
                                    <p>{{p.likes|length}}</p>
                                </td>
                                <td class="actions">
                                    <div class="btn-group btn-group-xs" role="group" aria-label="...">
                                        <button type="button" class="btn btn-default">Respond</button>
                                        <button type="button" class="btn btn-default">Dismiss</button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h3>Lists</h3>
                    <table class='table table-striped'>
                        <thead>
                            <th>Name</th>
                            <th>Users</th>
                            <th></th>
                        </thead>
                        <tbody>
                            {% for l in lists %}
                            <tr>
                                <td>{{l.name}}</td>
                                <td>{{"{:,}".format(l.users)}}</td>
                                <td>
                                    <a class='btn btn-primary' href="{{url_for('lists.index')}}" role="button">View</a>
                                    <a class='btn btn-danger' href='' role="button">Share</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h3>Segments</h3>
                    <table class='table table-striped'>
                        <thead>
                            <th>Name</th>
                            <th>Users</th>
                            <th></th>
                        </thead>
                        <tbody>
                            {% for s in segments %}
                            <tr>
                                <td>{{s.name}}</td>
                                <td>{{"{:,}".format(s.count)}}</td>
                                <td>
                                    <a class='btn btn-primary' href="{{url_for('audience.id', id=s._id|string)}}" role="button">View</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="col-md-12">
                <div class="thumbnail">
                    {{ bucket("Audience", "Supporters", like_change['total'], like_change['change'], "#", "Grow") }}
                </div>
            </div>
            <div class="col-md-12">
                <div class="thumbnail">
                    {{ bucket("Engagement", "Engaged Supporters", engagement_change['total'], engagement_change['change'], "#", "Boost") }}
                </div>
            </div>
            <div class="col-md-12">
                <div class="thumbnail">
                    {{ bucket("Impact", "Actions this week", 19898, 5, "#", "Discover") }}
                </div>
            </div>
            <div class="col-md-12">
                <div class="thumbnail">
                    {{ bucket("Buzz", "Actions this week", 19898, 5, "#", "Discover") }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
