<div id="term{{filter['field']|string|slugify}}">
    <input type="text" id="input{{filter['field']|string|slugify}}" class="term-input" data-field="{{filter['field']}}"/>
</div>
<script>

    $("#input{{filter['field']|string|slugify}}").autocomplete({
        minLength: 2,
        source:"{{ url_for('.autocomplete', field=filter['field']) }}",
        multiselect: true,
        {% set val = values.get(filter['field'].replace('.', '___'), []) %}
        values:eval({{val|to_json}}),

        change: function(e, ui){
            filters["{{filter['field']}}"] = ui.item.value;
            console.log(filters);
            refresh(e);
        },
        delete: function(e, ui){
            var val = $(e).data('value');
            delete ui.selectedItems[val];
            delete filters["{{filter['field']}}"];
            refresh(e);
            console.log("REMOVED", filters);
        }
    });

    $("#input{{filter['field']|string|slugify}}").on("autocompleteselect", refresh);

</script>
